<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>關於VirtualBox的一些詭異問題排解方法</h1><p>最近因為VMWare Workstation Pro不再支援Shared VMs，因此轉回VirtualBox。用了一陣子的感想只能說VirtualBox相較於VMWare Workstation Pro，真的是坑坑洞洞小問題不少，不若VMWare Workstation Pro安裝後的穩定。但沒辦法，畢竟是免費軟體對上商業軟體，有差距還是可以理解的。</p><h2>Windows服務只有跑一次就終止</h2><p>這個問題是我在GuestOS安裝了自己寫的Windows Services後發現的，本來這個服務的程式碼是沒有任何問題的：</p><ol><li>開機<code>登入</code>Windows後，會持續的自己不斷運行。</li><li>開機<code>登入</code>Windows後再登出，也會持續的自己不斷運行。</li><li>...但是...Windows開機尚未登入時，服務<code>只會運行一次就結束了</code>，這個問題讓我非常的困惑，因為在VMWare Workstation Pro上測試的時候是沒有任何問題的！況且Windows Services本身沒有介面就已經很難除錯了，結果跌跌撞撞寫了一大堆Log最終也是Log了個寂寞（沒有任何錯誤）。</li></ol><p>在網路上找遍各種資料提到的解決方法都沒用，最後誤打誤撞因為要先處理別的事情，因此設定了下列這個時間同步的指令後意外的發現，竟然解決了？！</p><pre><code class=language-txt>VBoxManage setextradata "GuestOS Name" "VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled" 0
</code></pre><p>可能有人會說有可能是我的服務基於時間的不正確才引爆這個錯誤，因此在設定這個指令後有可能時間就正確了，但這個推論是錯誤的，因為我的服務在時間錯誤的時候（其實只是時間沒那麼正確，例如跟正確時間差個兩三分鐘）依然能跑，請仔細回想我剛才說的：登入Windows後服務會持續的自己不斷運行。</p><p>所以真正為何的原因我自己也不清楚，只能說問題就這樣解決了。</p><h2>GuestOS裡面的程式執行特定時數後就死了</h2><p>這裡指的程式是指我自己寫的Windows Services（但我認為一般的可執行程式也會有這個問題），發生的原因依然不明，狀況就是好好的運行<code>大約40小時</code>後就會自己終止運行，我推論可能是因為VirtualBox基於某種機制（或者某種資源管理不當）導致的，總之就是整個程式被中斷運行。</p><p>由於我寫的是服務，因此進入<code>服務管理員</code>裡面查看，就看到狀態是<code>停止</code>，如果是我的程式有錯誤或是當下的Windows環境缺乏某種資源，理論上按下<code>啟動</code>應該會失敗才對，但按下後竟然他媽的成功了，而且又<code>持續運行了很久</code>才又發生前面描述的事情。</p><p>由於這種詭異的問題想當然爾你在網路上是問不出個所以然的，因此我只能胡亂推論是又是VirtualBox那個<code>莫名其妙睡著</code>的問題導致，最後使用<code>排程管理員</code>每一小時對VirtualBox GuestOS更改一次螢幕硬體（相當於插入螢幕），上述問題就在下列這個莫名其妙的指令中解決了？！</p><pre><code>VBoxManage controlvm "GuestOS Name" setvideomodehint 1020 765 32
</code></pre><h2>GuestOS在Session 0的時候無法正確執行</h2><p>我有一個Guest OS必須在Host OS尚未登入Windows時期就起來工作（Session 0），我非常確定所有的程式都是正常的，在這個Session 0時期所有的動作就是停擺無法使用，這個問題我在網路上找了很久也沒有任何的解決方法，最後我只能用<code>排程管理員</code>來解決這個問題，在確定Guest OS開機完成後過五分鐘，執行插入螢幕硬體：</p><pre><code class=language-txt>VBoxManage controlvm "GuestOS Name" setvideomodehint 1020 765 32
</code></pre><p>這樣就解決了！</p><p>那麼我們會以為問題解決了，但其實這個問題會複合上面推論的<code>VirtualBox的睡著問題</code>，他可能在一天後整個程式又會死掉！目前我採用的方式是定時重啟這個GuestOS，除此之外我已經別無他法。</p><h3>感想</h3><p>上面說的問題我都已經確定GuestOS的Windows電源管理設定都是指定到最高效能，螢幕也沒有設定休眠關閉之類的東西，也沒有休眠按鈕也都設定無作用，但是還是會一直發生這些詭異的問題。只能說VirtualBox的問題真的不少，這些問題我在VMWare Workstation Pro上面是完全不會發生的，這是不是一種免費的最貴的概念？（問題是VMWare Workstation Pro也免費了啊！哈哈哈...）</p><h6>VirtualBox WeirdProblem Solution Nonsense NonOfficial</h6></main><footer></footer><script src=/.file/site.js></script></body></html>