<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>逐步安裝Node.JS並實作SVG Path（文字路徑）產生器</h1><p>在之前的文章中，我們實現了在瀏覽器端依據我們在網頁中給定的中文字型，繪製出SVG向量路徑在網頁上，讓網頁上某些需要使用特別指定文字的標題，可以突破以往用圖片來表示的困境，開始往無失真的方向移動，無論你的螢幕解析度有多高，顯示出來的文字因為是基於SVG PATH繪圖，所以根本沒有所謂的低解析度模糊之問題。</p><p>但，在上述的應用場景下，於Client端實作這樣的功能根本無濟於事，因為高容量的「中文字型」下載到終端根本是一場鬧劇，若可以接受這樣的流量那說真的也不需要SVG的技術來繪製了，直接上WebFont豈不妙哉？</p><p>這時候在茫茫NPM大海中我發現了一個叫做<a href=https://www.npmjs.com/package/text-to-svg>text-to-svg</a>的套件，一實驗下去發現這就是我期待中的功能，太妙了啊！</p><h2>逐步安裝Node.JS</h2><p>Step 1. 撰寫文章的時刻Node.JS的版本來到12.16.3，可以到下列連結下載Windows x64 LTS Windows Installer安裝檔案：<a href=https://nodejs.org/en/download/>Download the Node.js</a>，點擊安裝程式。</p><p><img src=https://content.slashview.com/img/2020/20200503_01.jpg alt="" /></p><p>Step 2. 同意授權。</p><p><img src=https://content.slashview.com/img/2020/20200503_02.jpg alt="" /></p><p>Step 3. 指定安裝目錄，x64版本預設指定到Programs Files目錄。</p><p><img src=https://content.slashview.com/img/2020/20200503_03.jpg alt="" /></p><p>Step 4. 理論上是全部裝（重點是一定要裝npm套件管理器），但我沒有裝線上文件捷徑。</p><p><img src=https://content.slashview.com/img/2020/20200503_04.jpg alt="" /></p><p>Step 5. 是否安裝其他必要工具，這邊我是沒有勾選安裝。</p><p><img src=https://content.slashview.com/img/2020/20200503_05.jpg alt="" /></p><p>Step 6. 按下Install開始安裝。</p><p><img src=https://content.slashview.com/img/2020/20200503_06.jpg alt="" /></p><p>Step 7. 安裝完成。</p><p><img src=https://content.slashview.com/img/2020/20200503_07.jpg alt="" /></p><p>Step 8. 安裝完成後其實環境變數Path裡面已經被自動加入node與npm執行檔路徑，因此隨便開個console來跑一下node，觀察完版本號碼後可以輸入「.exit」離開。</p><p><img src=https://content.slashview.com/img/2020/20200503_08.jpg alt="" /></p><h2>利用黑洞級別的npm套件管理器來安裝text-to-svg</h2><p>Step 1. 利用指令建立GenerateSvgText目錄，並作為基本的App運行目錄後，開始在裡面安裝text-to-svg，請輸入指令：</p><p>npm install text-to-svg</p><p>Step 2. 經過npm黑洞級別的相依套件安裝後（其實就這個套件來說算還好），你會看到一堆WARN警告的訊息，不用理會這些訊息。若你不想看到這些警告訊息的話，可以先進行下方npm init步驟後再來執行這個步驟，會來的比較正規。</p><p><img src=https://content.slashview.com/img/2020/20200503_09.jpg alt="" /></p><p>Step 3. 用DIR指令查看這些目錄，可以發現一個叫做「node_modules」的資料夾，這裡面就是所有的text-to-svg依存套件存放的位置。</p><p><img src=https://content.slashview.com/img/2020/20200503_10.jpg alt="" /></p><h2>開始創造text-to-svg運算環境</h2><p>Step 1. 利用npm init建立專案環境，如此一來可以健全package.json：</p><p><img src=https://content.slashview.com/img/2020/20200503_11.jpg alt="" /> <img src=https://content.slashview.com/img/2020/20200503_12.jpg alt="" /></p><p>Step 2. 下載幾個你自己喜歡的字型，文中為例子是採用Google的「Noto Sans Mono CJK TC Regular.otf」，並創造一個叫做fonts的子資料夾將字型放入其中。</p><p><img src=https://content.slashview.com/img/2020/20200503_13.jpg alt="" /></p><p>Step 4. 接下來就是撰寫entry point（index.js）的程式碼：</p><p><img src=https://content.slashview.com/img/2020/20200503_14.jpg alt="" /></p><pre><code class=language-js>const cText = process.argv.slice(2)[0];
const cFontPathAndName = __dirname + "/fonts/Noto Sans Mono CJK TC Regular.otf";
const oOptions = {
  fontSize: 100,
  anchor: "left top"
};
const oSVG = require("text-to-svg");
const oInstance = oSVG.loadSync(cFontPathAndName);
console.log(oInstance.getSVG(cText, oOptions));
</code></pre><p>P.S 這邊的程式碼你完全都要遵守node.js的規範與函式，這裡的範例只是隨便亂實作一下，事實上text-to-svg還有提供很多的參數可以帶入產生不同的效果，請自行上網查閱：<a href=https://www.npmjs.com/package/text-to-svg#api>Text-To-Svg API</a></p><p>Step 5. 撰寫完後馬上來試一下，可以看到已經有產生出向量文字路徑了。</p><p><img src=https://content.slashview.com/img/2020/20200503_15.jpg alt="" /></p><p>Step 6. 直接輸出轉向到「svg.html」檔案。</p><p><img src=https://content.slashview.com/img/2020/20200503_16.jpg alt="" /></p><p>Step 7. 在瀏覽器中檢視的效果，可以正確的產生出向量文字路徑。</p><p><img src=https://content.slashview.com/img/2020/20200503_17.jpg alt="" /></p><h2>成果展示</h2><p>以下就是svg.html真實輸出的向量文字，可以直接看網頁的原始碼就可以知道效果。要知道下面這段SVG向量文字的產生已經拋棄掉Client瀏覽器端下載肥大的中文字型檔案的架構嘍！你可以試著把網頁畫面直接放到，依然可以看到無鋸齒失真的文字。</p><p><svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink width=600 height=148><path fill=black d="M26.70 48.70L26.70 90.40L14.60 90.40L14.60 48.70ZM33.60 41.80L7.70 41.80L7.70 106.80L14.60 106.80L14.60 97.30L33.60 97.30ZM78.40 89.70L78.40 111.90L51.20 111.90L51.20 89.70ZM44 124L51.20 124L51.20 118.60L78.40 118.60L78.40 123.70L85.80 123.70L85.80 83L44 83ZM50.80 64.90C56.70 58.80 61.70 51.90 65.60 44.40C69.70 51.90 75.10 59.10 80.80 64.90ZM63 32.50C58 46.40 47.50 60.10 34.40 68.90C36.20 70.10 38.60 72.70 39.80 74.20C43 72 46 69.50 48.80 66.80L48.80 71.70L81.60 71.70L81.60 65.70C84.50 68.60 87.60 71.10 90.60 73.20C91.90 71.30 94.30 68.40 96 67.10C85.70 61.20 75 49.20 68.90 37.40C69.30 36.40 69.70 35.40 70.10 34.40ZM124.40 48.70L124.40 99.50L114 99.50L114 48.70ZM130.30 41.80L107.70 41.80L107.70 114.50L114 114.50L114 106.40L130.30 106.40ZM176.20 99.20C174.20 103 171.40 106.30 167.40 109C162 107.40 156.60 106 151.50 104.80C153 103.10 154.50 101.20 156.20 99.20ZM145.30 74.80L161.20 74.80L161.20 80.90L145.30 80.90ZM184.20 74.80L184.20 80.90L168.20 80.90L168.20 74.80ZM147.20 59.70L147.20 53.70L161.20 53.70L161.20 59.70ZM161.20 43.70L161.20 49.20L147.20 49.20L147.20 43.70ZM182 43.70L182 49.20L168.20 49.20L168.20 43.70ZM168.20 59.70L168.20 53.70L182 53.70L182 59.70ZM195.60 99.20L195.60 93.30L185.40 93.30C185.60 91.90 186 90.40 186.30 89L179.60 89C179.30 90.40 178.90 91.90 178.50 93.30L160.60 93.30C162.40 90.80 164.10 88.30 165.50 85.90L191.20 85.90L191.20 69.70L168.20 69.70L168.20 64.70L188.70 64.70L188.70 54.40L194.90 54.40L194.90 48.60L188.70 48.60L188.70 38.70L168.20 38.70L168.20 32.30L161.20 32.30L161.20 38.70L140.70 38.70L140.70 48.60L134.30 48.60L134.30 54.40L140.70 54.40L140.70 64.70L161.20 64.70L161.20 69.70L138.60 69.70L138.60 85.90L157.70 85.90C156.30 88.30 154.60 90.80 152.80 93.30L133.50 93.30L133.50 99.20L148.20 99.20C145.70 102.30 143.10 105.20 140.80 107.60C146.90 109 153.50 110.80 160 112.70C153.60 115.30 145.10 117.10 133.80 118.40C134.90 119.70 136.10 122.30 136.60 123.90C150.90 122.10 161 119.30 168.30 115.40C176.40 118 183.70 120.90 188.70 123.40L194.20 118.70C189 116.30 182 113.70 174.50 111.30C178.50 107.80 181.30 103.90 183.30 99.20ZM226.70 32.70C221 47.90 211.80 62.80 202 72.40C203.40 74.10 205.40 77.90 206.20 79.70C209.60 76 213.10 71.90 216.30 67.30L216.30 123.40L223.40 123.40L223.40 56.20C227.30 49.40 230.80 42.20 233.70 34.80ZM244.90 74.90C242.20 86.70 237.50 98.60 231.20 106.20C233 107.20 236.20 109.10 237.60 110.30C243.70 102 249 89.40 252.20 76.30ZM287.20 58.40C286.40 63.50 285.50 68.80 284.90 72.40L291.10 73.60C292.40 68.30 294.20 59.70 295.50 52.40L290.40 51.20L289.20 51.50L248.70 51.50C250.70 46 252.50 40.20 254 34.40L246.70 32.80C243.40 47.40 237.60 61.70 230.30 70.90C231.90 72 235 74.50 236.20 75.60C239.80 70.90 243.10 65 245.90 58.40L261.10 58.40L261.10 114.60C261.10 115.90 260.70 116.30 259.40 116.30C258.10 116.30 253.80 116.40 249.10 116.20C250.10 118.30 251.30 121.60 251.70 123.70C258 123.70 262.20 123.50 264.90 122.20C267.50 121 268.40 118.80 268.40 114.60L268.40 58.40ZM275.70 76.30C281 86.80 286 100.80 287.60 109.90L294.70 107.50C293 98.40 287.90 84.70 282.20 74.10ZM333.40 60.80C333.20 70.50 331.90 82.10 326.40 93.50C322.60 90.20 318.60 87.10 314.80 84.20C316.50 77.70 318.40 69.70 320 61.60ZM346.20 60L346.30 53.20L340.50 53.50L340.50 46.60L333.50 46.60L333.50 53.90L321.30 54.60C322.60 47.20 323.80 39.70 324.60 33L317.30 32.60C316.60 39.40 315.50 47.30 314.10 54.90C310.40 55 307 55.20 304.10 55.30L304.90 62.40L312.80 62C310.80 71.30 308.70 80.20 306.70 86.70C311.80 90.60 317.50 95.20 322.80 99.90C318.60 106.50 312.70 113 304.50 118.80C306 119.90 308.60 122.30 309.70 123.90C317.80 118 323.90 111.50 328.30 104.80C332.90 109.10 337 113.20 339.80 116.60L344.60 110.40C341.60 106.90 337.10 102.70 332.10 98.30C338.70 85.10 340.20 71.60 340.50 60.40ZM395.60 74.50L373.60 74.50L373.60 64.90C380.60 58.80 387.70 50.40 392.60 43L387.50 39.30L385.80 39.70L347.40 39.70L347.40 46.60L380.70 46.60C376.60 52.40 371.20 58.90 366.10 63.10L366.10 74.50L343 74.50L343 81.60L366.10 81.60L366.10 114.80C366.10 116.20 365.50 116.70 363.90 116.70C362.40 116.80 356.90 116.80 351 116.60C352.10 118.70 353.30 121.60 353.70 123.70C361.50 123.80 366.30 123.60 369.40 122.50C372.50 121.30 373.60 119.20 373.60 114.80L373.60 81.60L395.60 81.60ZM427.40 48.80L427.40 88.40L414.30 88.40L414.30 48.80ZM434.10 95.30L434.10 41.90L407.60 41.90L407.60 104.60L414.30 104.60L414.30 95.30ZM437.30 119.90C441.80 114.20 444 104.50 445.30 96.40L439.70 94.80C438.50 102.60 436.10 111.70 431.90 117.10ZM449.90 96.40C451.60 102.80 452.40 110.80 452.20 116L457.70 115.10C457.80 109.90 457 101.80 455.20 95.60ZM460.90 95.70C463.30 101 465.70 108 466.40 112.70L471.60 110.90C470.70 106.40 468.30 99.40 465.70 94.10ZM448.20 74L463.50 74L463.50 83.60L448.20 83.60ZM463.50 43.50L463.50 52.70L448.20 52.70L448.20 43.50ZM463.50 68.10L448.20 68.10L448.20 58.70L463.50 58.70ZM470.40 83.60L470.40 74L488.80 74L488.80 68.10L470.40 68.10L470.40 58.70L488.80 58.70L488.80 52.70L470.40 52.70L470.40 43.50L490.80 43.50L490.80 36.90L441.30 36.90L441.30 90L486.60 90C485.60 107.70 484.40 114.50 482.70 116.30C481.90 117.30 481 117.50 479.50 117.50C478 117.50 474.10 117.40 469.80 117C470.90 118.70 471.60 121.50 471.70 123.40C476.20 123.60 480.40 123.60 482.60 123.40C485.30 123.20 486.90 122.60 488.50 120.80C491.10 117.70 492.30 109.20 493.60 86.70C493.70 85.70 493.70 83.60 493.70 83.60ZM471.80 93.90C474.50 98.10 477.20 103.70 478.30 107.60L482.90 105.60C481.80 101.90 479 96.40 476.20 92.30ZM544.50 91.80L552.70 91.80C550 76.80 573.90 73.70 573.90 58.60C573.90 47.10 564.90 39.90 550.80 39.90C539.90 39.90 532.10 44.50 525.50 51.50L530.90 56.50C536.50 50.40 543 47.40 549.80 47.40C560 47.40 565 52.40 565 59.30C565 70.70 541.40 75.20 544.50 91.80ZM540.70 108.60C540.70 113.40 544.40 116.50 548.80 116.50C553.20 116.50 556.80 113.40 556.80 108.60C556.80 103.80 553.20 100.80 548.80 100.80C544.40 100.80 540.70 103.80 540.70 108.60Z" /></svg></p><h3>後記</h3><p>在前一篇的文章中我就有提到希望把功能搬回.NET Server端環境上面，但這篇文章跟伺服器端的ASP.NET或C#有何關係？這是node.js啊？</p><p>當然有關係啊，別忘了我們是在Windows Console下利用Node.JS運行V8引擎起來跑這段程式碼，這意味著我們可以利用Console模式的輸出來達到結果的產生，接下來只是擷取與傳遞的過程了不是嗎？但特別要叮嚀各位朋友，V8引擎每次的生成與毀滅雖然速度快，但耗費的CPU與記憶體也是非常可觀的，建議真實的設計上要加入Cache機制，不要去進行重複的運算為佳。</p><p>npm我稱為黑洞級別算是客氣了，可參考這張在程式設計界之間流傳的圖就知道所言不假：</p><p><img src=https://content.slashview.com/img/2020/20200503_18.jpg alt="" /></p><p>相關參考文章：</p><ol><li><a href=/archive2020/20200501.html>基於瀏覽器之SVG Path（文字路徑）產生器</a></li><li><a href=/archive2017/20170206.html>透過Console執行Exe檔案，並動態取回回傳值</a></li></ol><h6>Chinese Font TTF OTF Genernate Calculate SVG Path Node.JS npm ServerSide CAPTCHA TextCopyDisabled</h6></main><footer></footer><script src=/.file/site.js></script></body></html>