<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>System.IO.File.Delete引發的路徑存取被拒錯誤</h1><p>網站發生了一個詭異的System.IO.File.Delete引發的錯誤，中文大致上的意思是指「未經處理的異常...System.UnauthorizedAccessException...存取路徑XXX被拒...」。這問題詭異的地方是這個、、不可能有刪除檔案權限的問題（因為用同樣的身分可建立檔案）。</p><p>這問題詭異的地方是：</p><ol><li>路徑確定正常。</li><li>網站用來存取檔案的身分正常（該身分擁有這個目錄的完整控制權）。</li><li>刪除用同一個身分建立的檔案出錯。（確定檔案由該身分建立）</li></ol><p>遇到這種見鬼的問題，依照多年的經驗毫不眷戀在網站運行身分的稽查上，馬上把錯誤訊息的英文對照版找出來，拋到網路找類似的苦主，英文錯誤訊息為：</p><pre><code class=language-txt>An unhandled exception of type 'System.UnauthorizedAccessException' occurred in mscorlib.dll Additional information: Access to the path 'C:\YourOwnPath' is denied. 
</code></pre><p>馬上就在網路找到答案，真的有人跟我一樣使用System.IO.File.Delete()方法產生問題。解決的方式也很簡單，就是在刪除前把檔案的屬性變更一下就可以了。</p><pre><code class=language-cs>System.IO.File.SetAttributes("C:\YourOwnPath\YourFileName.ext", System.IO.FileAttributes.Normal);
System.IO.File.Delete("C:\YourOwnPath\YourFileName.ext");
</code></pre><p>說真的我不知道為何將檔案的屬性變更為Normal就可以，我也很確定我要刪除的目標檔案沒有被設定成唯獨（readonly），我懷疑應該是<a href=/archive2014/20140526.html>ADS的Zone.Identifier</a>害的，因為這陣子太忙了，總之程式碼可以正常運作後我就沒有去管它了。</p><h6>UnhandledException System.UnauthorizedAccessException mscorlib.dll System.IO.File.Delete</h6></main><footer></footer><script src=/.file/site.js></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7039045520564660"></script></body></html>