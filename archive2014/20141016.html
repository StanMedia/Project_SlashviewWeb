<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>Windows Server啟動磁碟配額管理機制（Quota Management）</h1><p>在早期Winodws Server 2003的配額可以說是非常的不方便，到了Winodws Server 2008之後有大幅度的改善了這個問題，因此在Windows Server的磁碟配額設定上，變得很輕鬆且易於管理使用者的磁碟存取量，我們就來看看怎麼設定吧！</p><p>這個範例是以Windows Server 2012版本來說明，由於這是英文的試用版＋繁中語言包，因此有一些介面會出現一點點沒有翻譯到的英文，這部份要先注意一下喔！</p><h2>安裝階段</h2><p>Step 01. 首先在伺服器管理員＞管理＞新增角色及功能</p><p><img src=https://content.slashview.com/img/2014/20141016_01.jpg alt="" /></p><p>Step 02. 出現了新增角色及功能精靈</p><p><img src=https://content.slashview.com/img/2014/20141016_02.jpg alt="" /></p><p>Step 03. 點選角色型或功能型安裝</p><p><img src=https://content.slashview.com/img/2014/20141016_03.jpg alt="" /></p><p>Step 04. 點選從伺服器集區選取伺服器（要選到你要安裝的這台伺服器喔！）</p><p><img src=https://content.slashview.com/img/2014/20141016_04.jpg alt="" /></p><p>Step 05. 勾選「File Server」及「File Server Resource Manager」</p><p><img src=https://content.slashview.com/img/2014/20141016_05.jpg alt="" /></p><p>Step 06. 在勾選「File Server Resource Manager」會自動跳出提示視窗，說這個功能需要自動追加某些功能。</p><p><img src=https://content.slashview.com/img/2014/20141016_06.jpg alt="" /></p><p>Step 07. 回到原視窗後，直接點下一步</p><p><img src=https://content.slashview.com/img/2014/20141016_07.jpg alt="" /></p><p>Step 08. 沒有要新增其它功能，所以直接下一步</p><p><img src=https://content.slashview.com/img/2014/20141016_08.jpg alt="" /></p><p>Step 09. 點選完成後，會開始安裝相關檔案</p><p><img src=https://content.slashview.com/img/2014/20141016_09.jpg alt="" /></p><p>Step 10. 安裝完成後，請點關閉</p><p><img src=https://content.slashview.com/img/2014/20141016_10.jpg alt="" /></p><p>Step 11. 保險起見，還是重開一下伺服器會比較好</p><p><img src=https://content.slashview.com/img/2014/20141016_11.jpg alt="" /></p><h2>設定階段</h2><p>Step 12. 開完機後，點選伺服器管理員＞工具＞檔案伺服器管理員</p><p><img src=https://content.slashview.com/img/2014/20141016_12.jpg alt="" /></p><p>Step 13. 點選左側配額範本＞再點選右側的建立配額範本</p><p><img src=https://content.slashview.com/img/2014/20141016_13.jpg alt="" /></p><p>Step 14. 範本名稱打「我的測試配額」，為了好測試我們選擇上限10MB比較方便。另外我們選固定配額，就是使用者超過後就不允許寫入任何資料到硬碟了。都點完後，點選「新增」這個按鈕進入通知設定。</p><p><img src=https://content.slashview.com/img/2014/20141016_14.jpg alt="" /></p><p>Step 15. 在這個範例裡面，我們跳過電子郵件訊息，進入到事件記錄器，也就是當配額出現我們設定的條件發生時，就記錄到事件記錄簿內。以下圖這個範例來說，我們希望磁碟配額到達85%就寫入到事件簿內，讓管理者可以得知一下資訊。</p><p><img src=https://content.slashview.com/img/2014/20141016_15.jpg alt="" /></p><p>Step 16. 另外也請循上例做個100%也通知的事件條件。</p><p><img src=https://content.slashview.com/img/2014/20141016_16.jpg alt="" /></p><p>Step 17. 接下來請回到檔案伺服器資源管理員，點左側配額圖示，然後點右側的建立配額。</p><p><img src=https://content.slashview.com/img/2014/20141016_17.jpg alt="" /></p><p>Step 18. 假設我們的電腦有一個叫John的成員，我們也開了一個D:\JohnUseOnly的資料夾，並設定給John權限可以存取。那麼接下來我們要做的事情，就是把配額路徑指向D:\JohnUseOnly，並且套用「我的測試配額」範本，確定後點「建立」。</p><p><img src=https://content.slashview.com/img/2014/20141016_18.jpg alt="" /></p><p>Step 19. 完成後，中間的視窗區就會出現你剛才設定的配額嘍，John這個人只有10MB的使用空間。</p><p><img src=https://content.slashview.com/img/2014/20141016_19.jpg alt="" /></p><h2>驗證階段</h2><p>Step 20. 離開Administrator，換John這個成員登入系統。</p><p><img src=https://content.slashview.com/img/2014/20141016_20.jpg alt="" /></p><p>Step 21. 因為我們要測試的配額目標只有10MB，但我們需要的是大約1MB檔案的大小，來進行持續的新增才看的到效果，因此我們需要調用FSUtil這隻程式來幫我們做一個空白的1MB檔案讓我們使用。請依循下圖的方式來建立1MB的空白檔案在D:\JohnUseOnly資料夾內。</p><p><img src=https://content.slashview.com/img/2014/20141016_21.jpg alt="" /></p><pre><code class=language-txt>//這個指令可以在Windows下建立一個容量為1MB之空白純文字檔案
//Sample.txt後面的數字，單位是Bytes
FSUTIL FILE CreateNew Sample.txt 1000000
</code></pre><p>Step 22. 建立完Sample.txt後，當然我們就是按下Ctrl+V然後狂貼嘍，建立文字檔後的大小約是977KB。貼到第11筆時我們可以發現磁碟配額發生效果了，這個使用者被限制不可以再寫入任何檔案，這代表已經成功了。</p><p><img src=https://content.slashview.com/img/2014/20141016_22.jpg alt="" /></p><h2>管理者驗證階段</h2><p>Step 23. 接下來換管理者上場，來驗證一下是不是真的在85%跟100%時，都會有通知寫到事件記錄簿內。請點選伺服器管理員＞工具＞事件檢視器</p><p><img src=https://content.slashview.com/img/2014/20141016_23.jpg alt="" /></p><p>Step 24. 我們在自訂檢視＞系統管理事件中，可以發現有2個SRMSVC Events跑出來，我們選第一筆發現，在85%到達時，伺服器的確有記載使用者John存取JohnUseOnly資料夾，發生了快溢滿的狀況，Event ID 12325。（在實務上，這個事件應該要寄Email給使用者做通知。）</p><p><img src=https://content.slashview.com/img/2014/20141016_24.jpg alt="" /></p><p>Step 25. 當然啦！100%一定也要通知的嘛，所以點第二筆可以看到相關內容嘍。</p><p><img src=https://content.slashview.com/img/2014/20141016_25.jpg alt="" /></p><p>以上就是Windows Server安裝磁碟配額／磁碟空間限制的步驟與實驗過程。</p><h6>WindowsServer DiskQuota DiskQuotaManager 配額 限額 資料夾限制空間 資料夾限制大小 EventId12325 FolderAndVolumeQuotaEnforcement</h6></main><footer></footer><script src=/.file/site.js></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7039045520564660"></script></body></html>