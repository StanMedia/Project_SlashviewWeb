<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>在ASP.NET WSP模式中，啟用C# 6.0（Roslyn）編譯器</h1><p>在WSP（Web Site Project）伺服器端升級安裝完成.NET Framework 4.6.1後，滿心的期待可以使用C# 6.0（Roslyn）編譯器的新語法，卻發現還是只能使用舊版的C# 5.0的語法，覺得好沮喪。難道WSP終將被消滅？還是微軟愛上新歡.NET Core而忘了自己的老主顧.NET Framework了？</p><p><img src=https://content.slashview.com/img/2016/20160617_01.jpg alt="" /></p><h2>將ASP.NET強制上C# 6.0（Roslyn）編譯器的方法</h2><p>Step 1: 請先將你的伺服器升級到.NET Framework 4.6.1。雖然編譯器趨勢已經要慢慢地跟.NET平台脫鉤了，但是請還是先升級比較保險。升級後別忘了去修改一下自己的web.config裡面的targetFramework版本號。</p><p>Step 2: 到「<a href=https://www.nuget.org/>Nuget 官網</a>」下載最後一個版本的exe，將exe放到桌面。</p><p>Step 3: 用系統管理者的權限啟動一個cmd，切到桌面路徑下，輸入下列命令：</p><p>nuget install Microsoft.Net.Compilers</p><p>Step 4: 經過一連串的連線下載後，你的桌面會出現一個下載資料夾，名稱大概會是「Microsoft.Net.Compilers.x.x.x」。</p><p>Step 5: 進入到「Microsoft.Net.Compilers.x.x.x」的「tools」資料夾下，選取這個資料夾下裡面全部的檔案並且複製起來。</p><p>Step 6: 依你自己的伺服器環境設定，例如進入到「C:\Windows\Microsoft.NET\Framework64\v4.0.30319」，將你剛才複製的檔案貼到這個目錄中，這時候系統會提示你總共有6個檔案會衝突，請一律選擇覆蓋（取代）。衝突的檔案列表如下，可想而知就是C#跟VB.NET的編譯器嘍：</p><pre><code class=language-txt>csc.exe
csc.exe.config
csc.rsp
vbc.exe
vbc.exe.config
vbc.rsp
</code></pre><p>Step 7: 恭喜升級csc.exe成為C# 6.0版本（Roslyn）完成！可以的話，重開機。不可以的話，至少做一下iisreset。</p><p>※ 備註１：其實CodeAnalysis等相關的DLL，都在Step.6都處理掉了。</p><p>※ 備註２：我猜這種土匪方式等到下一次升級.NET Framework 4.6.2時，csc.exe會被蓋回來。除非.NET Framework 4.6.2已經不包含csc.exe的升級。總之，還是希望微軟把新一代的語言編譯器整到.NET Framework安裝包啦！（2021-01-13實測證實：升級到.NET Framework 4.8時，csc.exe以及相關檔案被全數蓋回來，等於之前用C#5版本後寫的新語法都不編譯。）</p><p>※ 備註３：Roslyn是微軟新一代的編譯平台代號，Microsoft.CodeDom.Providers.DotNetCompilerPlatform是ASP.NET團隊對於Roslyn的CodeDOM封裝。</p><p>※ 備註４：若你的IIS網站之前一直沿用C# 5.0編譯器，當你安裝.NET Framework 4.6.2之類的，並去修改web.config中的compilation targetFramework="4.6.2"，此舉並不會讓你的編譯器自動升級為C# 6.0（但在開發時其於VisualStudio中若進行.NET Framework版本切換，則會自動實作編譯器的切換），請拋棄這個幻想並實作本篇文章。</p><p>相關連結：</p><ul><li><a href=/archive2021/20210114.html>在ASP.NET WSP模式中，啟用C# 9.0（Roslyn）編譯器</a></li><li><a href=/archive2017/20170817.html>在ASP.NET WSP模式中，啟用C# 7.0（Roslyn）編譯器</a></li><li><a href=/archive2017/20171212.html>快速進行WSP網站之C#（Roslyn）編譯器相關檔案覆蓋作業</a></li><li><a href=/archive2017/20171211.html>在不使用nuget的情況下，讓WSP可以在VisualStudio中使用C#新語法</a></li></ul><h6>Enable Initial .NETCompiler ASP.NET C#6.0 Csc.exe System.CodeDom.Compiler</h6></main><footer></footer><script src=/.file/site.js></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7039045520564660"></script></body></html>