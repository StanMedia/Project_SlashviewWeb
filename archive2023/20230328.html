<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>GitHub pages與Cloudflare DNS設定的相關問題與排除</h1><p>日前在Cloudflare上使用了DNS服務，並將設定套用到Github時出現了在其他品牌的網域名稱服務商上都沒有遭遇過的問題，將問題逐一解析與解法紀錄此備忘與分享。</p><h2>無法啟動GitHub pages的Enforce HTTPS</h2><p>Cloudflare DNS與其他域名商不同之處，就是提供了很多隱性的安全防護功能，例如DNS Proxy也是一層不錯的防護，而也正就是這樣的服務讓GitHub pages的設定受到挑戰。</p><p>由下圖我們可以看到，有一個CNAME名為some的網域名稱被設定，並且透過Cloudflare DNS Proxy提供服務。</p><p><img src=https://content.slashview.com/img/2023/20230328_01.jpg alt="" /></p><p>這時候我們去瀏覽這個名為some的GitHub pages網站可以發現，該網站的HTTPS SSL憑證，是由Cloudflare送你的萬用SSL憑證所提供，簽發的組織是<code>Google Trust Services LLC</code>。</p><p><img src=https://content.slashview.com/img/2023/20230328_02.jpg alt="" /></p><p>也就是因為這個原因，GitHub pages的<code>Enforce HTTPS</code>變得無法點選（因為無法簽發SSL）。</p><p><img src=https://content.slashview.com/img/2023/20230328_03.jpg alt="" /></p><h2>可以啟動GitHub pages的Enforce HTTPS</h2><p>事實上可以發現，在無法點選<code>Enforce HTTPS</code>的狀況下，GitHub pages的網站還是可以透過Cloudflare的<code>萬用SSL憑證</code>提供HTTPS的連接，這是無妨的。但如果你只想要使用GitHub提供的SSL憑證，那麼就要去Cloudflare DNS裡面，把DNS Proxy關閉掉，如下圖。</p><p><img src=https://content.slashview.com/img/2023/20230328_04.jpg alt="" /></p><p>關閉掉Cloudfalre DNS Proxy後過一陣子，再去GitHub pages網站上面看，就可以發現憑證改成由GitHub簽發的SSL了，簽發的組織是免費的<code>Let's Encrpt</code>。</p><p><img src=https://content.slashview.com/img/2023/20230328_05.jpg alt="" /></p><p>上面所謂的過一陣子，就是要讓GitHub pages有時間去跑自動化申請<code>Let's Encrpt</code>，這段時間有時候很快一兩分鐘就有，有時候可能30分鐘甚至一小時都有可能，如果你遇到還沒有出現憑證的話，可能需要給他一點時間。如果自動化憑證簽發完成後，<code>Enforce HTTPS</code>就會亮起來可以勾選嘍。</p><p><img src=https://content.slashview.com/img/2023/20230328_06.jpg alt="" /></p><h3>小結</h3><p>還是必須要再強調一次，無論是哪一種憑證都沒有好壞之分，作法上也沒有好壞之分，端看你想要用哪一種組織簽發的憑證。如果你就是想要用<code>Let's Encrpt</code>憑證且開啟<code>Enforce HTTPS</code>功能，那就要把Cloudflare DNS Proxy關閉。</p><h2>WWW主網站網域名稱問題</h2><p>假設我在Cloudflare DNS的開啟了一個WWW的域名，且DNS Proxy也關閉了，如下圖所示：</p><p><img src=https://content.slashview.com/img/2023/20230328_07.jpg alt="" /></p><p>回到GitHub pages會看到<code>NotServedByPagesError</code>錯誤資訊，如下列：</p><pre><code class=language-txt>test.com is improperly configured
Domain does not resolve to the GitHub Pages server. For more information, see documentation (NotServedByPagesError).
</code></pre><p><img src=https://content.slashview.com/img/2023/20230328_08.jpg alt="" /></p><p>會形成這樣的原因是因為GitHub沒有辦法拿到test.com的控制權，因此我們必須把頂級網域（Apex domains）交給GitHub。請在Cloudflare這邊下指令把所有的A Records都轉到GitHub的DNS主機。</p><pre><code class=language-txt>185.199.108.153
185.199.109.153
185.199.110.153
185.199.111.153
</code></pre><p><img src=https://content.slashview.com/img/2023/20230328_09.jpg alt="" /></p><p>完成後過一陣子，再去GitHub的設定畫面，就可以看到一切恢復正常啦！再也看不到黃色的<code>NotServedByPagesError</code>警告方框了。</p><p><img src=https://content.slashview.com/img/2023/20230328_10.jpg alt="" /></p><h3>特別說明</h3><p>如果你希望採用的是<code>Apex domains</code>作為<code>GitHub Pages</code>的預設網域名稱（例如：text.com），也把上面的四組<code>A Records</code>都轉到GitHub了，這時候你應該還是會看到GitHub Pages還是持續給你跳出<code>www.test.com is improperly configured</code>的黃色警告方框，這代表GitHub仍然希望你把<code>www</code>的使用權交給他。這時候我們就要去DNS服務那邊新增一組CNAME如下，然後默默等候DNS更新即可。</p><pre><code class=language-txt>CNAME    www    yourGitHubAccount.github.io.
</code></pre><h3>相關連結</h3><ul><li><a href=https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain>GitHub pages - Configuring an apex domain</a></li></ul><h6>GitHubPages CloudflareDns CloudflareDnsProxy Setting SSL HTTPS EnforceHTTPS NotServedByPagesError</h6></main><footer></footer><script src=/.file/site.js></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7039045520564660"></script></body></html>