<!DOCTYPE html><html><head><meta charset=utf-8 /><meta name=viewport content="width=device-width, initial-scale=1" /><link href=/.file/site.css rel=stylesheet /><script src=/.include/jquery/jquery.min.js></script></head><body><header></header><main><h1>Windows造字程式與字元對應表之字型無法匹配問題</h1><p>今天發現一個超詭異的現象，就是<code>Windows造字程式</code>（EudcEdit.exe）與<code>字元對應表</code>（CharMap.exe）明明確定是同一組字碼，卻出現不同形狀的字符，簡單的說就是文字根本不一樣。</p><h2>Windows造字程式與字元對應表裡面的文字不一致</h2><p>經過抽絲剝繭後發現，字元對應表似乎會將造字後的檔案快取起來，舉例來說，我們在<code>已經出問題的電腦</code>裡面打開<code>字元對應表</code>，<code>FA40</code>看到了一個文字假設是<code>堃</code>，然後我們打開了<code>Windows造字程式</code>，在<code>FA40</code>將原本的<code>堃</code>改了新的造字<code>尛</code>，然後存檔，又去字型連結裡面連結所有的字型，看起來一切都很完美。</p><p>但最終的結果是，造字程式的<code>FA40</code>的確顯示<code>尛</code>，但字元對應表顯示的卻是<code>堃</code>。</p><h2>文字不一致會造成怎樣的問題？</h2><p>現代是瀏覽器的時代，為了罕見字有時候我們會請使用者端下載造字檔案放到自己的電腦（<a href=/archive2021/20211122.html>更新造字字型檔</a>），然後瀏覽器透過CSS設定<code>font-family: EUDC;</code>來調用客戶端的系統造字來顯示文字。</p><p>而這個文字不一致的問題會形成很嚴重的問題，那就是：<code>明明我已經下載更新造字檔案，罕見字為什麼顯示不出來？（或者是顯示成不對的文字）</code>，接下來就是程式設計師跟使用者互相指責的時間了。</p><h2>證明字元對應表有建立快取</h2><p>如果你有跟上述描述的情況一樣，可以透過這個方式證明。</p><ol><li>將<code>C:\Windows\Fonts</code>字型資料夾裡面的<code>eudc*.*</code>全部砍掉。</li><li>重新開機。</li><li>打開<code>Windows造字程式</code>發現，因為沒有造字檔所以確定是空白。</li><li>打開<code>字元對應表</code>後你會發現，先前的造字依然顯示在上面。</li></ol><p>由上面的步驟4可以得知，系統的造字檔案明明都砍了，怎麼還會看到先前的造字，一定有快取。</p><h2>字元對應表的快取放在哪裡？怎麼刪除？</h2><p>理論上是放在下方目錄，檔名會以<code>EUDC*.tte</code>呈現，例如：eudc.tte、eudc_0.tte、eudc_1.tte...</p><pre><code class=language-txt>C:\Users\YourUserName\AppData\Local\Microsoft\Windows\Fonts
</code></pre><p>用<code>系統管理員的權限</code>進來這個目錄下，基本上裡面的檔案全部都會被系統鎖定，所以你只能依照古老的造字替換大法來移除，也就是先改檔名（例如eudc.tte.bak）→重開機→再刪除。</p><h2>觀察到的現象與結論</h2><ul><li>字型的<code>快取目錄</code>位於<code>C:\Users\YourUserName\AppData\Local\Microsoft\Windows\Fonts</code>。</li><li>快取目錄下的字型檔案在系統開機時會被讀入到記憶體某處，也就是說當你把這個目錄下的<code>eudc.tte</code>更名成<code>eudc.tte.bak</code>後，在重開機之前其實還是會顯示<code>eudc.tte</code>的文字。</li><li><code>eudc.tte</code>更名成<code>eudc.tte.bak</code>這個動作，必須在開機尚未執行任何程式或瀏覽網頁之前就進行，一旦執行了任何程式就有可能被栓鎖。</li><li>當快取目錄<code>有造字檔案</code>時，系統會在適當的時機（例如執行<code>字元對應表</code>或瀏覽<code>具備造字CSS網站</code>）載入此目錄的造字拿去呈現在畫面上且檔案會被 栓鎖，這時候透過<code>Windows造字程式</code>所新增修改的任何造字，其實都再也不關系統顯示造字的事情了，相當於系統永遠以快取目錄的造字檔案為主。</li><li>當快取目錄<code>沒有造字檔案</code>時，<code>字元對應表</code>列表上不會有造字字型檔案顯示，也就是你看不到系統的造字列表了，除非進去<code>Windows造字程式</code>裡面看。</li><li>當快取目錄<code>沒有造字檔案</code>時，系統會在適當的時機會去字型目錄（<code>C:\Windows\Fonts</code>）拿造字檔案（<code>eudc.tte</code>）。當然，這個<code>eudc.tte</code>檔案一樣會被栓鎖。</li><li>當字型目錄（<code>C:\Windows\Fonts</code>）的造字檔案（<code>eudc.tte</code>）被栓鎖，透過<code>Windows造字程式</code>新增修改的任何造字並儲存，一律會顯示<code>記憶體資源不足</code>及<code>記憶體不足。請在其他處理程序完成後重試。</code>。</li><li>想要正確的新增修改造字檔案，又想要正確的顯示造字，請跟隨下列設定：<ol><li>拋棄<code>字元對應表</code>程式，以後都在<code>Windows造字程式</code>查閱造字。</li><li>清空字型<code>快取目錄</code>底下的EUDC字型檔案。</li><li>若要新增修改造字請在開機後馬上執行，確定都完成後再去執行顯示造字的系統程式，例如：瀏覽器、記事本...等。</li></ol></li></ul><h6>Windows 造字程式 EudcEdit.exe 字元對應表 CharMap.exe 罕見字 Unicode Big5</h6></main><footer></footer><script src=/.file/site.js></script></body></html>